---
title: "p8105_hw_5_bw2595"
author: "Blair Wigsten"
date: "11/6/2019"
output: html_document
---

```{r}
getwd()
```

# Problem 1: load packages 

```{r}
library(tidyverse)
library(readr)
library(purrr)

set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))
iris_with_missing
```

```{r}
replaced_iris = function(x) {
  if(is.numeric(x)) {
    ifelse(is.na(x), mean(x, na.rm = TRUE), x)
  } else if (is.character(x)) {
    ifelse(is.na(x), "virginica", x)
  }
}

iris_full = map_df(iris_with_missing, replaced_iris)
iris_full
```



# Problem 2

* Start with a dataframe containing all file names; the list.files function will help
* Iterate over file names and read in data for each subject using purrr::map and saving the result as a new variable in the dataframe
* Tidy the result; manipulate file names to include control arm and subject ID, make sure weekly observations are “tidy”, and do any other tidying that’s necessary

```{r}
data = tibble(
  observation = list.files(path = "./data")
)
data
```


# Problem 3

```{r}
sim_regression = function(n = 30, beta0 = 2, beta1 = 0) {

  sim_data = tibble(
    x = rnorm(n, mean = 0, sd = 1),
    y = beta0 + beta1 * x + rnorm(n, 0, 50^0.5))

  ls_fit = lm(y ~ x, data = sim_data)
  
  broom::tidy(ls_fit) %>%
    filter(term == "x")
}

sim_results = rerun(100, sim_regression()) %>%
  bind_rows()

results = tibble(
  beta1 = c(0, 1, 2, 3, 4, 5, 6)) %>%
  mutate(
    output_list = map(.x = beta1, ~rerun(100, sim_regression(beta1 = .x))),
    estimate_dfs = map(output_list, bind_rows)) %>%
  select(-output_list) %>%
  unnest(estimate_dfs)
results
```

Make a plot showing the proportion of times the null was rejected (the power of the test) on the y axis and the true value of β2 on the x axis. Describe the association between effect size and power. 

```{r}
graph1 = results %>%
  mutate(
    significant = cut(p.value, breaks = c(0, 0.05, Inf), labels = c("significant", "not significant"))) %>%
  group_by(beta1, significant) %>%
  summarize(number = n()) %>%
  mutate(
    proportion = number / sum(number),
     as.character(beta1)) %>%
  filter(significant == "significant") %>%
  ggplot(aes(x = beta1, y = proportion)) +
  geom_point() + geom_line(group = 1) +
  labs(
      title = "Power of the Test",
      x = "True Value of Beta1",
      y = "Proportion of Times Null was Rejected")
graph1
```

* As the true value of Beta1 increases (the effect size), the power of the test increases. As beta1 moves from 1 to 4, the increase is drastic, then approaches the asymptote of 1 as the effect size reaches 6. 

